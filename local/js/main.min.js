function grs(a){var b="";for(a=a||32;0<a;--a)b+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ:`|'"[Math.floor(66*Math.random())];return b}
function getPuzzleCompleteCallback(a,b){return function(){var c=grs(12),d=grs(32);c=$.extend({action:"complete",score:c,token:d,target:md5(c+d)},b);$.post({url:a,data:c,dataType:"json"}).done(function(a){a.success&&(a.updateScreenData&&parent.updateGameScreen(a.updateScreenData),setTimeout(function(){parent.openGameFancybox("#star-map-complete")},2E3))})}}function makeDiamandComplate(a){getGemsCompleteCallback("/tasks/task4",a).call()}
function getGemsCompleteCallback(a,b){return function(){var c=$.extend({action:"complete"},b);$.post({url:a,data:c,dataType:"json"}).done(function(a){if(a.success){a.updateScreenData&&parent.updateGameScreen(a.updateScreenData);var b=$("#crystal-energy-complete",parent.document);b.length&&($(".count",b).html(a.gemsCount),$(".accent",b).html(a.scoreText),parent.openGameFancybox(b))}})}}
function updateGameScreen(a){a.profile&&updateProfile(a.profile);a.slides&&$.each(a.slides,function(a,c){updateSlide(c)})}function updateProfile(a){a.score&&$(".profile .profile_points").html(a.score);a.photo&&$(".profile #profile-img image").attr("xlink:href",a.photo)}function updateSlide(a){var b=$('.game-slider_item[data-slide-id="'+a.id+'"]');b.length&&(b.html($(a.html).html()),reInitSlideJs(b))}function reInitSlideJs(a){}
function openGameFancybox(a,b){openFancyboxInternal(a,b||fancyConfigGame)}function openMainFancybox(a,b){openFancyboxInternal(a,b||fancyConfigMain)}function openFaqFancybox(a,b){openFancyboxInternal(a,b||fancyConfigFaq)}
$(function(){$(document).on("popup:close",function(a,b){b&&"update-game-screen"===b.action&&updateGameScreen(b)});$(".btn-light-side, .btn-dark-side","#two-sides").click(function(a){a.preventDefault();var b=$(".btn-light-side, .btn-dark-side","#two-sides");$(this).data("pending")||(b.data("pending",!0),a=$(this).data("url")||$(this).attr("href"),$.post({url:a,dataType:"json"}).done(function(a){if(a.success){a.updateScreenData&&updateGameScreen(a.updateScreenData);var b="#two-sides-"+a.side+"-complete";
$.each(a.shareUrls,function(a,c){$(".social-link."+a,b).data("url",c)});openGameFancybox(b)}}).always(function(){b.data("pending",!1)}))});$("#form-abonus-card").on("beforeSubmit",function(){var a=$(this);if(a.data("pending"))return!1;a.data("pending",!0);$.post({url:a.attr("action"),data:a.serialize(),dataType:"json"}).done(function(a){a.success&&openGameFancybox("#lost-coordinates-next");a.updateScreenData&&updateGameScreen(a.updateScreenData)}).always(function(){a.data("pending",!1)});return!1});
$("#ticket-decline").click(function(a){a.preventDefault();var b=$(this);b.data("pending")||(b.data("pending",!0),a=b.data("url")||b.attr("href"),$.post({url:a,dataType:"json"}).done(function(a){a.success&&a.updateScreenData&&updateGameScreen(a.updateScreenData)}).always(function(){b.data("pending",!1)}))});$("#form-tickets-share-link").on("beforeSubmit",function(){var a=$(this);if(a.data("pending"))return!1;a.data("pending",!0);$.post({url:a.attr("action"),data:a.serialize(),dataType:"json"}).done(function(a){a.success&&
(a.updateScreenData&&updateGameScreen(a.updateScreenData),$("#tickets-share-link","#last-jedi-accept").text(a.shortLink).attr("title",a.link),openGameFancybox("#last-jedi-accept"))}).always(function(){a.data("pending",!1)});return!1});$("#send-ticket-to-email").click(function(a){a.preventDefault();var b=$(this);b.data("pending")||(b.data("pending",!0),a=b.data("url")||b.attr("href"),$.post({url:a,dataType:"json"}).done(function(a){if(a.success){var c=b.next("p").not(".accent");if(c.length){var e=
c.html();b.next("p").addClass("accent").html("\u041f\u0438\u0441\u044c\u043c\u043e \u043e\u0442\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u043e.");setTimeout(function(){c.removeClass("accent").html(e)},5E3)}}}).always(function(){b.data("pending",!1)}))});$(document).on("click","#accept-ticket, #decline-ticket",function(a){a.preventDefault();var b=$("#accept-ticket, #decline-ticket");$(this).data("pending")||(b.data("pending",!0),a=$(this).data("url")||$(this).attr("href"),$.post({url:a,dataType:"json"}).done(function(a){a.success&&
a.updateScreenData&&updateGameScreen(a.updateScreenData)}).always(function(){b.data("pending",!1)}))});$("input","#last-mission").change(function(){this.checked&&("postcard-light"===this.id?($("#postcard-dark-share").hide(),$("#postcard-light-share").show()):($("#postcard-light-share").hide(),$("#postcard-dark-share").show()))});$(".social-link","#last-mission").click(function(){var a=$("#last-mission"),b=$("input:checked",a);b=b.length&&"postcard-light"===b.attr("id")?2:1;var c=$(this).data("type");
a.data("remember")&&!a.data("pending")&&(a.data("pending",!0),$.post({url:a.data("remember-url"),data:{card:b,sn:c},dataType:"json"}).always(function(){a.data("pending",!1)}))})});