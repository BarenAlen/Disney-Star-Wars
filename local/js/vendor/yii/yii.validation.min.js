/*
 Copyright (c) 2008 Yii Software LLC
 @license http://www.yiiframework.com/license/
 @author Qiang Xue <qiang.xue@gmail.com>
 @since 2.0
*/
yii.validation=function(h){function k(b,c,a){if("undefined"===typeof File)return[];b=h(b.input,b.$form).get(0).files;return b?0===b.length?(a.skipOnEmpty||c.push(a.uploadRequired),[]):a.maxFiles&&a.maxFiles<b.length?(c.push(a.tooMany),[]):b:(c.push(a.message),[])}function l(b,c,a){if(a.extensions&&0<a.extensions.length){var d=b.name.lastIndexOf(".");d=~d?b.name.substr(d+1,b.name.length).toLowerCase():"";~a.extensions.indexOf(d)||c.push(a.wrongExtension.replace(/\{file\}/g,b.name))}if(a.mimeTypes&&
0<a.mimeTypes.length){a:{d=a.mimeTypes;for(var e=b.type,f=0,h=d.length;f<h;f++)if((new RegExp(d[f])).test(e)){d=!0;break a}d=!1}d||c.push(a.wrongMimeType.replace(/\{file\}/g,b.name))}a.maxSize&&a.maxSize<b.size&&c.push(a.tooBig.replace(/\{file\}/g,b.name));a.minSize&&a.minSize>b.size&&c.push(a.tooSmall.replace(/\{file\}/g,b.name))}var e={isEmpty:function(b){return null===b||void 0===b||h.isArray(b)&&0===b.length||""===b},addMessage:function(b,c,a){b.push(c.replace(/\{value\}/g,a))},required:function(b,
c,a){var d=!1;if(void 0===a.requiredValue){var g="string"==typeof b||b instanceof String;if(a.strict&&void 0!==b||!a.strict&&!e.isEmpty(g?h.trim(b):b))d=!0}else if(!a.strict&&b==a.requiredValue||a.strict&&b===a.requiredValue)d=!0;d||e.addMessage(c,a.message,b)},"boolean":function(b,c,a){a.skipOnEmpty&&e.isEmpty(b)||(a.strict||b!=a.trueValue&&b!=a.falseValue)&&(!a.strict||b!==a.trueValue&&b!==a.falseValue)&&e.addMessage(c,a.message,b)},string:function(b,c,a){a.skipOnEmpty&&e.isEmpty(b)||("string"!==
typeof b?e.addMessage(c,a.message,b):void 0!==a.is&&b.length!=a.is?e.addMessage(c,a.notEqual,b):(void 0!==a.min&&b.length<a.min&&e.addMessage(c,a.tooShort,b),void 0!==a.max&&b.length>a.max&&e.addMessage(c,a.tooLong,b)))},file:function(b,c,a){b=k(b,c,a);h.each(b,function(b,e){l(e,c,a)})},image:function(b,c,a,d){b=k(b,c,a);h.each(b,function(b,f){l(f,c,a);if("undefined"!==typeof FileReader){var g=h.Deferred();e.validateImage(f,c,a,g,new FileReader,new Image);d.push(g)}})},validateImage:function(b,c,
a,d,e,f){f.onload=function(){a.minWidth&&f.width<a.minWidth&&c.push(a.underWidth.replace(/\{file\}/g,b.name));a.maxWidth&&f.width>a.maxWidth&&c.push(a.overWidth.replace(/\{file\}/g,b.name));a.minHeight&&f.height<a.minHeight&&c.push(a.underHeight.replace(/\{file\}/g,b.name));a.maxHeight&&f.height>a.maxHeight&&c.push(a.overHeight.replace(/\{file\}/g,b.name));d.resolve()};f.onerror=function(){c.push(a.notImage.replace(/\{file\}/g,b.name));d.resolve()};e.onload=function(){f.src=this.result};e.onerror=
function(){d.resolve()};e.readAsDataURL(b)},number:function(b,c,a){a.skipOnEmpty&&e.isEmpty(b)||("string"!==typeof b||a.pattern.test(b)?(void 0!==a.min&&b<a.min&&e.addMessage(c,a.tooSmall,b),void 0!==a.max&&b>a.max&&e.addMessage(c,a.tooBig,b)):e.addMessage(c,a.message,b))},range:function(b,c,a){if(!a.skipOnEmpty||!e.isEmpty(b))if(!a.allowArray&&h.isArray(b))e.addMessage(c,a.message,b);else{var d=!0;h.each(h.isArray(b)?b:[b],function(b,c){return-1==h.inArray(c,a.range)?d=!1:!0});void 0===a.not&&(a.not=
!1);a.not===d&&e.addMessage(c,a.message,b)}},regularExpression:function(b,c,a){a.skipOnEmpty&&e.isEmpty(b)||(!a.not&&!a.pattern.test(b)||a.not&&a.pattern.test(b))&&e.addMessage(c,a.message,b)},email:function(b,c,a){if(!a.skipOnEmpty||!e.isEmpty(b)){var d=/^((?:"?([^"]*)"?\s)?)(?:\s+)?(?:(<?)((.+)@([^>]+))(>?))$/.exec(b);if(null===d)d=!1;else{var g=d[5],f=d[6];a.enableIDN&&(g=punycode.toASCII(g),f=punycode.toASCII(f),b=d[1]+d[3]+g+"@"+f+d[7]);d=64<g.length?!1:254<(g+"@"+f).length?!1:a.pattern.test(b)||
a.allowName&&a.fullPattern.test(b)}d||e.addMessage(c,a.message,b)}},url:function(b,c,a){if(!a.skipOnEmpty||!e.isEmpty(b)){a.defaultScheme&&!/:\/\//.test(b)&&(b=a.defaultScheme+"://"+b);var d=!0;if(a.enableIDN){var g=/^([^:]+):\/\/([^\/]+)(.*)$/.exec(b);null===g?d=!1:b=g[1]+"://"+punycode.toASCII(g[2])+g[3]}d&&a.pattern.test(b)||e.addMessage(c,a.message,b)}},trim:function(b,c,a){b=b.find(c.input);c=b.val();a.skipOnEmpty&&e.isEmpty(c)||(c=h.trim(c),b.val(c));return c},captcha:function(b,c,a){if(!a.skipOnEmpty||
!e.isEmpty(b)){var d=h("body").data(a.hashKey);d=null==d?a.hash:d[a.caseSensitive?0:1];for(var g=a.caseSensitive?b:b.toLowerCase(),f=g.length-1,k=0;0<=f;--f)k+=g.charCodeAt(f);k!=d&&e.addMessage(c,a.message,b)}},compare:function(b,c,a){if(!a.skipOnEmpty||!e.isEmpty(b)){var d=void 0===a.compareAttribute?a.compareValue:h("#"+a.compareAttribute).val();"number"===a.type&&(b=parseFloat(b),d=parseFloat(d));switch(a.operator){case "==":d=b==d;break;case "===":d=b===d;break;case "!=":d=b!=d;break;case "!==":d=
b!==d;break;case ">":d=b>d;break;case ">=":d=b>=d;break;case "<":d=b<d;break;case "<=":d=b<=d;break;default:d=!1}d||e.addMessage(c,a.message,b)}},ip:function(b,c,a){if(!a.skipOnEmpty||!e.isEmpty(b)){var d=null,g=null,f=(new RegExp(a.ipParsePattern)).exec(b);f&&(d=f[1]||null,b=f[2],g=f[4]||null);!0===a.subnet&&null===g?e.addMessage(c,a.messages.noSubnet,b):!1===a.subnet&&null!==g?e.addMessage(c,a.messages.hasSubnet,b):!1===a.negation&&null!==d?e.addMessage(c,a.messages.message,b):6==(-1===b.indexOf(":")?
4:6)?((new RegExp(a.ipv6Pattern)).test(b)||e.addMessage(c,a.messages.message,b),a.ipv6||e.addMessage(c,a.messages.ipv6NotAllowed,b)):((new RegExp(a.ipv4Pattern)).test(b)||e.addMessage(c,a.messages.message,b),a.ipv4||e.addMessage(c,a.messages.ipv4NotAllowed,b))}}};return e}(jQuery);